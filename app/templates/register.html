{% extends "base.html" %}
{% block title %}Register - CodeMentor AI{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6 col-lg-5">
    <div class="card border-0 shadow-lg">
      <div class="card-body p-5">
        <!-- Header -->
        <div class="text-center mb-4">
          <div class="icon-circle bg-success bg-opacity-10 d-inline-flex align-items-center justify-content-center rounded-circle mb-3" style="width: 80px; height: 80px;">
            <span style="font-size: 2.5rem;">✨</span>
          </div>
          <h2 class="text-success fw-bold mb-2">Join CodeMentor AI</h2>
          <p class="text-muted">Create your account and start your coding journey</p>
        </div>
        
        <!-- Error Alert -->
        {% if error %}
        <div class="alert alert-danger border-0 d-flex align-items-center mb-4" role="alert">
          <span class="me-2">⚠️</span>
          <div>{{ error }}</div>
        </div>
        {% endif %}
        
        <!-- Registration Form -->
        <form method="POST" action="/register" class="needs-validation" novalidate>
          <div class="mb-4">
            <label for="name" class="form-label d-flex align-items-center">
              <span class="me-2">👤</span>
              <strong>Full Name</strong>
            </label>
            <input type="text" name="name" id="name" class="form-control form-control-lg" 
                   required placeholder="Enter your full name" minlength="2" maxlength="50">
            <div class="invalid-feedback">
              Please provide a valid name (2-50 characters).
            </div>
          </div>
          
          <div class="mb-4">
            <label for="email" class="form-label d-flex align-items-center">
              <span class="me-2">📧</span>
              <strong>Email Address</strong>
            </label>
            <input type="email" name="email" id="email" class="form-control form-control-lg" 
                   required placeholder="Enter your email address"
                   pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
            <div class="invalid-feedback">
              Please provide a valid email address.
            </div>
            <div class="form-text">
              <small class="text-muted">We'll never share your email with anyone else.</small>
            </div>
          </div>
          
          <div class="mb-4">
            <label for="password" class="form-label d-flex align-items-center">
              <span class="me-2">🔒</span>
              <strong>Password</strong>
            </label>
            <div class="position-relative">
              <input type="password" name="password" id="password" class="form-control form-control-lg" 
                     required placeholder="Create a strong password" minlength="8"
                     pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,}$">
              <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y pe-3" 
                      onclick="togglePassword('password')" style="border: none; background: none;">
                <span id="password-toggle-icon">👁️</span>
              </button>
            </div>
            <div class="invalid-feedback">
              Password must be at least 8 characters with uppercase, lowercase, and number.
            </div>
            <div class="password-strength mt-2">
              <div class="progress" style="height: 4px;">
                <div id="password-strength-bar" class="progress-bar" role="progressbar" style="width: 0%"></div>
              </div>
              <small id="password-strength-text" class="text-muted">Password strength: Weak</small>
            </div>
          </div>
          
          <div class="mb-4">
            <label for="confirm-password" class="form-label d-flex align-items-center">
              <span class="me-2">🔐</span>
              <strong>Confirm Password</strong>
            </label>
            <div class="position-relative">
              <input type="password" name="password" id="confirm-password" class="form-control form-control-lg" 
                     required placeholder="Confirm your password" minlength="8">
              <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y pe-3" 
                      onclick="togglePassword('confirm-password')" style="border: none; background: none;">
                <span id="confirm-password-toggle-icon">👁️</span>
              </button>
            </div>
            <div class="invalid-feedback">
              Passwords must match.
            </div>
          </div>
          
          <!-- Terms and Conditions -->
          <div class="mb-4">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
              <label class="form-check-label text-muted" for="terms">
                I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and 
                <a href="#" class="text-decoration-none">Privacy Policy</a>
              </label>
              <div class="invalid-feedback">
                You must agree to the terms and conditions.
              </div>
            </div>
          </div>
          
          <!-- Submit Button -->
          <button type="submit" class="btn btn-success btn-lg w-100 mb-4">
            <span class="me-2">🚀</span>
            Create Account
          </button>
        </form>
        
        <!-- Divider -->
        <div class="text-center mb-4">
          <div class="position-relative">
            <hr class="my-4">
            <span class="position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted">
              or
            </span>
          </div>
        </div>
        
        <!-- Login Link -->
        <div class="text-center">
          <p class="text-muted mb-3">Already have an account?</p>
          <a href="/login" class="btn btn-outline-secondary btn-lg">
            <span class="me-2">🔑</span>
            Sign In Instead
          </a>
        </div>
        
        <!-- Benefits Section -->
        <div class="mt-4 p-3 bg-light rounded">
          <h6 class="text-center mb-3 text-success">🎉 What you'll get:</h6>
          <div class="row text-center">
            <div class="col-4">
              <small class="text-muted">
                <span class="d-block mb-1">🤖</span>
                AI Assistant
              </small>
            </div>
            <div class="col-4">
              <small class="text-muted">
                <span class="d-block mb-1">🎯</span>
                Challenges
              </small>
            </div>
            <div class="col-4">
              <small class="text-muted">
                <span class="d-block mb-1">📊</span>
                Progress Tracking
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.icon-circle {
  transition: transform 0.3s ease;
}

.card:hover .icon-circle {
  transform: scale(1.05);
}

.form-control:focus {
  box-shadow: 0 0 0 0.2rem rgba(34, 197, 94, 0.25);
  border-color: var(--success-500);
}

.btn-success {
  background: linear-gradient(135deg, var(--success-600), var(--success-500));
  border: none;
  transition: all 0.3s ease;
}

.btn-success:hover {
  background: linear-gradient(135deg, var(--success-700), var(--success-600));
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
}

.btn-outline-secondary {
  border: 2px solid var(--secondary-300);
  color: var(--secondary-700);
  transition: all 0.3s ease;
}

.btn-outline-secondary:hover {
  background: var(--secondary-100);
  border-color: var(--secondary-400);
  color: var(--secondary-800);
  transform: translateY(-1px);
}

.form-check-input:checked {
  background-color: var(--success-600);
  border-color: var(--success-600);
}

.position-relative .btn-link {
  color: var(--secondary-500);
  text-decoration: none;
}

.position-relative .btn-link:hover {
  color: var(--success-600);
}

.password-strength .progress {
  background-color: var(--secondary-200);
}

.password-strength .progress-bar {
  transition: all 0.3s ease;
}

/* Dark mode adjustments */
body.dark-mode .bg-light {
  background: var(--secondary-800) !important;
  color: var(--secondary-300) !important;
}

body.dark-mode .text-muted {
  color: var(--secondary-400) !important;
}

/* Animation */
.card {
  animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>

<script>
// Form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

// Toggle password visibility
function togglePassword(fieldId) {
  const passwordInput = document.getElementById(fieldId);
  const toggleIcon = document.getElementById(fieldId + '-toggle-icon');
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    toggleIcon.textContent = '🙈';
  } else {
    passwordInput.type = 'password';
    toggleIcon.textContent = '👁️';
  }
}

// Password strength checker
document.getElementById('password').addEventListener('input', function() {
  const password = this.value;
  const strengthBar = document.getElementById('password-strength-bar');
  const strengthText = document.getElementById('password-strength-text');
  
  let strength = 0;
  let strengthLabel = 'Weak';
  let strengthColor = 'bg-danger';
  
  // Check password criteria
  if (password.length >= 8) strength += 25;
  if (/[a-z]/.test(password)) strength += 25;
  if (/[A-Z]/.test(password)) strength += 25;
  if (/\d/.test(password)) strength += 25;
  
  // Determine strength level
  if (strength >= 75) {
    strengthLabel = 'Strong';
    strengthColor = 'bg-success';
  } else if (strength >= 50) {
    strengthLabel = 'Medium';
    strengthColor = 'bg-warning';
  } else if (strength >= 25) {
    strengthLabel = 'Fair';
    strengthColor = 'bg-info';
  }
  
  // Update UI
  strengthBar.style.width = strength + '%';
  strengthBar.className = `progress-bar ${strengthColor}`;
  strengthText.textContent = `Password strength: ${strengthLabel}`;
});

// Password confirmation validation
document.getElementById('confirm-password').addEventListener('input', function() {
  const password = document.getElementById('password').value;
  const confirmPassword = this.value;
  
  if (password !== confirmPassword) {
    this.setCustomValidity('Passwords do not match');
  } else {
    this.setCustomValidity('');
  }
});

// Auto-focus first input
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('name').focus();
});

// Add loading state to submit button
document.querySelector('form').addEventListener('submit', function() {
  const submitBtn = this.querySelector('button[type="submit"]');
  const originalHTML = submitBtn.innerHTML;
  submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Creating account...';
  submitBtn.disabled = true;
  
  // Re-enable button after 3 seconds (in case of error)
  setTimeout(() => {
    submitBtn.innerHTML = originalHTML;
    submitBtn.disabled = false;
  }, 3000);
});

// Real-time email validation
document.getElementById('email').addEventListener('blur', function() {
  const email = this.value;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  
  if (email && !emailRegex.test(email)) {
    this.setCustomValidity('Please enter a valid email address');
  } else {
    this.setCustomValidity('');
  }
});
</script>
{% endblock %}